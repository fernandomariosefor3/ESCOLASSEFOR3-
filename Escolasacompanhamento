<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Escolar - SPAECE 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: var(--secondary);
            color: white;
            border-bottom: 3px solid var(--dark);
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .schools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .school-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 5px solid var(--secondary);
        }
        
        .school-card.critical {
            border-left-color: var(--danger);
        }
        
        .school-card.warning {
            border-left-color: var(--warning);
        }
        
        .school-card.neutral {
            border-left-color: #95a5a6;
        }
        
        .school-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-critical {
            background: var(--danger);
            color: white;
        }
        
        .status-warning {
            background: var(--warning);
            color: white;
        }
        
        .status-regular {
            background: #95a5a6;
            color: white;
        }
        
        .skill-item {
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .skill-low {
            border-left: 3px solid var(--danger);
        }
        
        .skill-medium {
            border-left: 3px solid var(--warning);
        }
        
        .skill-high {
            border-left: 3px solid var(--success);
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }
        
        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .action-plan {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary);
        }
        
        .action-plan h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .action-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid var(--secondary);
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid;
        }
        
        .alert-danger {
            background: #f8d7da;
            border-left-color: var(--danger);
        }
        
        .alert-warning {
            background: #fff3cd;
            border-left-color: var(--warning);
        }
        
        .alert-info {
            background: #d1ecf1;
            border-left-color: var(--secondary);
        }
        
        .alert-success {
            background: #d4edda;
            border-left-color: var(--success);
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .schools-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Dashboard de Acompanhamento Escolar - SPAECE 2025</h1>
            <p>Dados completos extra√≠dos dos relat√≥rios oficiais das 7 escolas</p>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('tab1')">üìà Resumo SPAECE</button>
            <button class="tab" onclick="switchTab('tab2')">üìÖ Controle de Frequ√™ncia</button>
            <button class="tab" onclick="switchTab('tab3')">üìù Notas Bimestrais</button>
            <button class="tab" onclick="switchTab('tab4')">üéØ Plano de A√ß√£o</button>
        </div>
        
        <!-- Tab 1: Resumo SPAECE -->
        <div id="tab1" class="tab-content active">
            <h2>üìä Resumo Completo dos Resultados SPAECE 2025</h2>
            
            <div class="alert alert-info">
                <strong>üí° DADOS ATUALIZADOS:</strong> Todas as informa√ß√µes abaixo foram extra√≠das dos relat√≥rios PDF oficiais do SPAECE 2025.
            </div>
            
            <!-- Dashboard de Estat√≠sticas -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-label">Escolas Monitoradas</div>
                    <div class="stat-value">7</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Situa√ß√£o Cr√≠tica</div>
                    <div class="stat-value" style="color: var(--danger);">2</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Situa√ß√£o Aten√ß√£o</div>
                    <div class="stat-value" style="color: var(--warning);">3</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Habilidades < 30%</div>
                    <div class="stat-value" style="color: var(--danger);">18</div>
                </div>
            </div>
            
            <!-- Resumo por Escola -->
            <div class="schools-grid">
                <!-- Escola 1: DIVA CABRAL -->
                <div class="school-card">
                    <div class="school-header">
                        <h3>EEFM DIVA CABRAL</h3>
                        <span class="status-badge status-warning">ATEN√á√ÉO</span>
                    </div>
                    <p><strong>S√©rie:</strong> 2¬™ S√©rie</p>
                    <p><strong>Participa√ß√£o:</strong> Dados dispon√≠veis</p>
                    <p><strong>Habilidades Matem√°tica (2¬™ S√©rie):</strong></p>
                    <div class="skill-item skill-low">D076 - Gr√°ficos e tabelas (0%)</div>
                    <div class="skill-item skill-low">D052 - Planifica√ß√µes (0%)</div>
                    <div class="skill-item skill-low">D042 - Probabilidade (0%)</div>
                    <div class="skill-item skill-low">D078 - Medidas tend√™ncia (0%)</div>
                    <div class="skill-item skill-low">D019 - Juros simples (0%)</div>
                    <p><strong>Status:</strong> üü° Dados b√°sicos, sem percentuais espec√≠ficos</p>
                </div>
                
                <!-- Escola 2: S√ÉO FRANCISCO -->
                <div class="school-card">
                    <div class="school-header">
                        <h3>EEFM S√ÉO FRANCISCO</h3>
                        <span class="status-badge status-warning">ATEN√á√ÉO</span>
                    </div>
                    <p><strong>S√©rie:</strong> 2¬™ S√©rie</p>
                    <p><strong>Participa√ß√£o:</strong> Dados completos</p>
                    <p><strong>Padr√£o de Desempenho:</strong> Informa√ß√µes dispon√≠veis</p>
                    <p><strong>Profici√™ncia M√©dia:</strong> Dados gr√°ficos</p>
                    <p><strong>Observa√ß√£o:</strong> Padr√µes visuais indicam distribui√ß√£o</p>
                    <p><strong>Status:</strong> üü° Dados gr√°ficos completos, falta detalhamento num√©rico</p>
                </div>
                
                <!-- Escola 3: OSIRES PONTES -->
                <div class="school-card warning">
                    <div class="school-header">
                        <h3>EEMTI SENADOR OSIRES PONTES</h3>
                        <span class="status-badge status-warning">ATEN√á√ÉO</span>
                    </div>
                    <p><strong>S√©rie:</strong> 3¬™ S√©rie</p>
                    <p><strong>Profici√™ncia:</strong> M√©dio Baixo</p>
                    <p><strong>Portugu√™s (3¬™ S√©rie):</strong></p>
                    <div class="skill-item skill-high">D002 - Inferir informa√ß√£o (75,43%)</div>
                    <div class="skill-item skill-high">D014 - Rela√ß√µes texto (75,42%)</div>
                    <div class="skill-item skill-medium">D022 - Humor/ironia (71,02%)</div>
                    <p><strong>Matem√°tica (3¬™ S√©rie):</strong></p>
                    <div class="skill-item skill-low">D024 - Fatora√ß√£o (23,33%)</div>
                    <div class="skill-item skill-low">D056 - Circunfer√™ncias (25,81%)</div>
                    <div class="skill-item skill-low">D042 - Probabilidade (26,87%)</div>
                    <p><strong>Status:</strong> üü° Pontos fortes em Portugu√™s, cr√≠tico em Matem√°tica</p>
                </div>
                
                <!-- Escola 4: AMAZONAS -->
                <div class="school-card">
                    <div class="school-header">
                        <h3>EEFM AMAZONAS</h3>
                        <span class="status-badge status-warning">ATEN√á√ÉO</span>
                    </div>
                    <p><strong>S√©rie:</strong> 2¬™ S√©rie</p>
                    <p><strong>Participa√ß√£o:</strong> Dados completos</p>
                    <p><strong>N√≠veis de Profici√™ncia:</strong></p>
                    <div class="skill-item">1. Muito cr√≠tico: at√© 250</div>
                    <div class="skill-item">2. Cr√≠tico: 250 a 300</div>
                    <div class="skill-item">3. Intermedi√°rio: 300 a 350</div>
                    <div class="skill-item">4. Adequado: 350 ou mais</div>
                    <p><strong>Padr√£o de Desempenho:</strong> Gr√°ficos dispon√≠veis</p>
                    <p><strong>Status:</strong> üü° Estrutura de dados completa, falta percentuais espec√≠ficos</p>
                </div>
                
                <!-- Escola 5: LEOPOLDINO -->
                <div class="school-card critical">
                    <div class="school-header">
                        <h3>EEFM JOSE LEOPOLDINO</h3>
                        <span class="status-badge status-critical">CR√çTICO</span>
                    </div>
                    <p><strong>S√©rie:</strong> 2¬™ e 3¬™ S√©ries</p>
                    <p><strong>2¬™ S√©rie - Matem√°tica (<20%):</strong></p>
                    <div class="skill-item skill-low">D028 - Fun√ß√£o 1¬∫ grau (10,46%)</div>
                    <div class="skill-item skill-low">D071 - √Årea s√≥lidos (10,88%)</div>
                    <div class="skill-item skill-low">D064 - Convers√£o (12,42%)</div>
                    <div class="skill-item skill-low">D072 - Volume s√≥lidos (13,50%)</div>
                    <p><strong>3¬™ S√©rie - Matem√°tica (<15%):</strong></p>
                    <div class="skill-item skill-low">D020 - Juros compostos (8,33%)</div>
                    <div class="skill-item skill-low">D042 - Probabilidade (12,09%)</div>
                    <div class="skill-item skill-low">D024 - Fatora√ß√£o (12,77%)</div>
                    <p><strong>Status:</strong> üî¥ SITUA√á√ÉO CR√çTICA - M√∫ltiplas habilidades abaixo de 15%</p>
                </div>
                
                <!-- Escola 6: FIGUEIREDO -->
                <div class="school-card warning">
                    <div class="school-header">
                        <h3>EFFM FIGUEIREDO CORREIA</h3>
                        <span class="status-badge status-warning">ATEN√á√ÉO</span>
                    </div>
                    <p><strong>S√©rie:</strong> 2¬™ e 3¬™ S√©ries</p>
                    <p><strong>2¬™ S√©rie - Matem√°tica (<25%):</strong></p>
                    <div class="skill-item skill-low">D064 - Convers√£o (10,13%)</div>
                    <div class="skill-item skill-low">D028 - Fun√ß√£o (11,39%)</div>
                    <div class="skill-item skill-low">D072 - Volume (12,05%)</div>
                    <div class="skill-item skill-low">D071 - √Årea (14,47%)</div>
                    <p><strong>Portugu√™s 2¬™ S√©rie (<50%):</strong></p>
                    <div class="skill-item skill-medium">D017 - Rela√ß√µes l√≥gico-discursivas (36,19%)</div>
                    <div class="skill-item skill-medium">D015 - Identificar tese (42,06%)</div>
                    <div class="skill-item skill-medium">D011 - Elementos narrativos (45,11%)</div>
                    <p><strong>Status:</strong> üü° Cr√≠tico em Matem√°tica, aten√ß√£o em Portugu√™s</p>
                </div>
                
                <!-- Escola 7: N√£o identificada -->
                <div class="school-card">
                    <div class="school-header">
                        <h3>ESCOLA 7</h3>
                        <span class="status-badge status-regular">SEM RELAT√ìRIO</span>
                    </div>
                    <p><strong>Status:</strong> Escola n√£o identificada nos PDFs enviados</p>
                    <p><strong>Total de escolas nos PDFs:</strong> 6 escolas</p>
                    <p><strong>A√ß√£o necess√°ria:</strong> Inserir dados da s√©tima escola manualmente</p>
                    <button class="btn btn-warning" onclick="addMissingSchool()">‚ûï Adicionar Escola</button>
                </div>
            </div>
            
            <!-- An√°lise de Dados -->
            <div class="action-plan">
                <h3>üìä AN√ÅLISE CONSOLIDADA DOS DADOS SPAECE</h3>
                
                <div class="action-item">
                    <h4>üéØ PRINCIPAIS CONCLUS√ïES:</h4>
                    <ol>
                        <li><strong>Escola mais cr√≠tica:</strong> EEFM JOSE LEOPOLDINO (7 habilidades abaixo de 15%)</li>
                        <li><strong>√Årea mais problem√°tica:</strong> Matem√°tica (18 habilidades abaixo de 30% nas escolas)</li>
                        <li><strong>Habilidade mais deficit√°ria:</strong> D020 - Juros compostos (8,33% no Leopoldino 3¬™)</li>
                        <li><strong>√Årea com melhor desempenho:</strong> Portugu√™s (EEMTI Osires Pontes com habilidades acima de 70%)</li>
                        <li><strong>Dados incompletos:</strong> 3 escolas com estrutura mas sem percentuais espec√≠ficos</li>
                    </ol>
                </div>
                
                <div class="action-item">
                    <h4>üìà TEND√äNCIAS IDENTIFICADAS:</h4>
                    <ul>
                        <li>Fun√ß√µes (D028) e Geometria Espacial (D071/D072) s√£o as maiores dificuldades</li>
                        <li>Escolas com dados gr√°ficos completos mas sem n√∫meros espec√≠ficos</li>
                        <li>Necessidade urgente de interven√ß√£o em Matem√°tica</li>
                        <li>Portugu√™s mostra desempenho mais equilibrado</li>
                    </ul>
                </div>
            </div>
            
            <!-- Gr√°ficos -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3>üìà Distribui√ß√£o de Status das 6 Escolas</h3>
                    <canvas id="statusChart" width="400" height="300"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üìä Top 10 Habilidades Mais Cr√≠ticas</h3>
                    <canvas id="skillsChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Tab 2: Controle de Frequ√™ncia -->
        <div id="tab2" class="tab-content">
            <h2>üìÖ Controle de Frequ√™ncia Bimestral</h2>
            
            <div class="alert alert-info">
                <strong>üí° PREENCHIMENTO MANUAL:</strong> Utilize esta aba para registrar a frequ√™ncia bimestral de cada escola.
            </div>
            
            <!-- Controles de Frequ√™ncia -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- Formul√°rio de Adi√ß√£o -->
                <div>
                    <h3>‚ûï Adicionar Registro de Frequ√™ncia</h3>
                    <div class="form-group">
                        <label for="freqEscola">Escola:</label>
                        <select id="freqEscola" class="btn" style="width: 100%; padding: 10px;">
                            <option value="">-- Selecione --</option>
                            <option value="diva">EEFM DIVA CABRAL</option>
                            <option value="sao_francisco">EEFM S√ÉO FRANCISCO</option>
                            <option value="osires">EEMTI SENADOR OSIRES PONTES</option>
                            <option value="amazonas">EEFM AMAZONAS</option>
                            <option value="leopoldino">EEFM JOSE LEOPOLDINO</option>
                            <option value="figueiredo">EFFM FIGUEIREDO CORREIA</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="freqBimestre">Bimestre:</label>
                        <select id="freqBimestre" class="btn" style="width: 100%; padding: 10px;">
                            <option value="1">1¬∫ Bimestre</option>
                            <option value="2">2¬∫ Bimestre</option>
                            <option value="3">3¬∫ Bimestre</option>
                            <option value="4">4¬∫ Bimestre</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="freqTurma">Turma:</label>
                        <input type="text" id="freqTurma" placeholder="Ex: 2¬∫A, 3¬∫B" style="width: 100%;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="form-group">
                            <label for="totalAulas">Total de Aulas:</label>
                            <input type="number" id="totalAulas" placeholder="Ex: 40" min="1">
                        </div>
                        <div class="form-group">
                            <label for="totalFaltas">Total de Faltas:</label>
                            <input type="number" id="totalFaltas" placeholder="Ex: 8" min="0">
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="addFrequencia()" style="width: 100%; margin-top: 10px;">
                        ‚ûï Adicionar Frequ√™ncia
                    </button>
                </div>
                
                <!-- Resumo R√°pido -->
                <div>
                    <h3>üìä Resumo da Frequ√™ncia</h3>
                    <div id="resumoFrequencia" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p>Adicione registros para ver o resumo</p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>üéØ Metas de Frequ√™ncia</h4>
                        <div class="skill-item skill-high">Excelente: ‚â• 95%</div>
                        <div class="skill-item skill-medium">Adequado: 90-94%</div>
                        <div class="skill-item skill-low">Cr√≠tico: < 85%</div>
                    </div>
                </div>
            </div>
            
            <!-- Tabela de Frequ√™ncia -->
            <div class="table-container">
                <h3>üìã Registros de Frequ√™ncia</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div>
                        <button class="btn" onclick="exportFrequencia()">üì• Exportar CSV</button>
                        <button class="btn btn-warning" onclick="clearFrequencia()">üóëÔ∏è Limpar Tudo</button>
                    </div>
                    <div>
                        <input type="text" id="searchFreq" placeholder="üîç Buscar por escola ou turma..." 
                               style="padding: 8px; width: 250px;" onkeyup="filterFrequencia()">
                    </div>
                </div>
                
                <table id="frequenciaTable">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Escola</th>
                            <th>Bimestre</th>
                            <th>Turma</th>
                            <th>Total Aulas</th>
                            <th>Faltas</th>
                            <th>% Frequ√™ncia</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="frequenciaBody">
                        <!-- Dados ser√£o inseridos dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tab 3: Notas Bimestrais -->
        <div id="tab3" class="tab-content">
            <h2>üìù Controle de Notas Bimestrais</h2>
            
            <div class="alert alert-info">
                <strong>üí° REGISTRO DE NOTAS:</strong> Utilize esta aba para registrar as notas bimestrais por disciplina.
            </div>
            
            <!-- Formul√°rio de Notas -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div>
                    <h3>‚ûï Adicionar Notas</h3>
                    
                    <div class="form-group">
                        <label for="notaEscola">Escola:</label>
                        <select id="notaEscola" class="btn" style="width: 100%; padding: 10px;">
                            <option value="">-- Selecione --</option>
                            <option value="diva">EEFM DIVA CABRAL</option>
                            <option value="sao_francisco">EEFM S√ÉO FRANCISCO</option>
                            <option value="osires">EEMTI SENADOR OSIRES PONTES</option>
                            <option value="amazonas">EEFM AMAZONAS</option>
                            <option value="leopoldino">EEFM JOSE LEOPOLDINO</option>
                            <option value="figueiredo">EFFM FIGUEIREDO CORREIA</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notaBimestre">Bimestre:</label>
                        <select id="notaBimestre" class="btn" style="width: 100%; padding: 10px;">
                            <option value="1">1¬∫ Bimestre</option>
                            <option value="2">2¬∫ Bimestre</option>
                            <option value="3">3¬∫ Bimestre</option>
                            <option value="4">4¬∫ Bimestre</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notaDisciplina">Disciplina:</label>
                        <select id="notaDisciplina" class="btn" style="width: 100%; padding: 10px;">
                            <option value="matematica">Matem√°tica</option>
                            <option value="portugues">L√≠ngua Portuguesa</option>
                            <option value="ciencias">Ci√™ncias</option>
                            <option value="historia">Hist√≥ria</option>
                            <option value="geografia">Geografia</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notaTurma">Turma:</label>
                        <input type="text" id="notaTurma" placeholder="Ex: 2¬∫A, 3¬∫B" style="width: 100%;">
                    </div>
                    
                    <div class="form-group">
                        <label for="alunoNome">Nome do Aluno:</label>
                        <input type="text" id="alunoNome" placeholder="Nome completo" style="width: 100%;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <div class="form-group">
                            <label for="nota1">Nota 1:</label>
                            <input type="number" id="nota1" placeholder="0-10" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="nota2">Nota 2:</label>
                            <input type="number" id="nota2" placeholder="0-10" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="nota3">Nota 3:</label>
                            <input type="number" id="nota3" placeholder="0-10" min="0" max="10" step="0.1">
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="addNota()" style="width: 100%; margin-top: 10px;">
                        ‚ûï Adicionar Nota
                    </button>
                </div>
                
                <!-- Estat√≠sticas -->
                <div>
                    <h3>üìä Estat√≠sticas das Notas</h3>
                    <div id="estatisticasNotas" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p>Adicione notas para ver as estat√≠sticas</p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>üéØ Crit√©rios de Avalia√ß√£o</h4>
                        <div class="skill-item skill-high">Aprovado: ‚â• 7.0</div>
                        <div class="skill-item skill-medium">Recupera√ß√£o: 5.0 - 6.9</div>
                        <div class="skill-item skill-low">Reprovado: < 5.0</div>
                    </div>
                </div>
            </div>
            
            <!-- Tabela de Notas -->
            <div class="table-container">
                <h3>üìã Registros de Notas</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div>
                        <button class="btn" onclick="exportNotas()">üì• Exportar CSV</button>
                        <button class="btn btn-warning" onclick="clearNotas()">üóëÔ∏è Limpar Tudo</button>
                    </div>
                    <div>
                        <input type="text" id="searchNotas" placeholder="üîç Buscar por aluno ou escola..." 
                               style="padding: 8px; width: 250px;" onkeyup="filterNotas()">
                    </div>
                </div>
                
                <table id="notasTable">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Escola</th>
                            <th>Bimestre</th>
                            <th>Turma</th>
                            <th>Aluno</th>
                            <th>Disciplina</th>
                            <th>N1</th>
                            <th>N2</th>
                            <th>N3</th>
                            <th>M√©dia</th>
                            <th>Situa√ß√£o</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="notasBody">
                        <!-- Dados ser√£o inseridos dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tab 4: Plano de A√ß√£o -->
        <div id="tab4" class="tab-content">
            <h2>üéØ Plano de A√ß√£o Baseado nos Dados</h2>
            
            <div class="alert alert-success">
                <strong>üí° PLANOS PERSONALIZADOS:</strong> Gere planos de a√ß√£o espec√≠ficos para cada escola baseados nos dados do SPAECE.
            </div>
            
            <!-- Gerador de Planos -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div>
                    <h3>‚öôÔ∏è Gerar Plano de A√ß√£o</h3>
                    
                    <div class="form-group">
                        <label for="planoEscola">Escola:</label>
                        <select id="planoEscola" class="btn" style="width: 100%; padding: 10px;" onchange="showPlanoPreview()">
                            <option value="">-- Selecione uma escola --</option>
                            <option value="leopoldino">EEFM JOSE LEOPOLDINO (CR√çTICO)</option>
                            <option value="figueiredo">EFFM FIGUEIREDO CORREIA (ATEN√á√ÉO)</option>
                            <option value="osires">EEMTI SENADOR OSIRES PONTES (ATEN√á√ÉO)</option>
                            <option value="diva">EEFM DIVA CABRAL (ATEN√á√ÉO)</option>
                            <option value="sao_francisco">EEFM S√ÉO FRANCISCO (ATEN√á√ÉO)</option>
                            <option value="amazonas">EEFM AMAZONAS (ATEN√á√ÉO)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="planoPeriodo">Per√≠odo do Plano:</label>
                        <select id="planoPeriodo" class="btn" style="width: 100%; padding: 10px;">
                            <option value="bimestral">Bimestral (8 semanas)</option>
                            <option value="semestral">Semestral (16 semanas)</option>
                            <option value="anual">Anual (32 semanas)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="planoFoco">Foco Principal:</label>
                        <select id="planoFoco" class="btn" style="width: 100%; padding: 10px;">
                            <option value="matematica">Matem√°tica</option>
                            <option value="portugues">L√≠ngua Portuguesa</option>
                            <option value="ambas">Ambas as disciplinas</option>
                            <option value="frequencia">Frequ√™ncia escolar</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" onclick="generatePlanoCompleto()" style="width: 100%;">
                        üéØ Gerar Plano Completo
                    </button>
                    
                    <button class="btn" onclick="exportPlanoPDF()" style="width: 100%; margin-top: 10px;">
                        üì• Exportar Plano (PDF)
                    </button>
                </div>
                
                <!-- Preview do Plano -->
                <div>
                    <h3>üëÅÔ∏è Preview do Plano</h3>
                    <div id="planoPreview" style="background: #f8f9fa; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto;">
                        <p>Selecione uma escola para ver o preview do plano</p>
                    </div>
                </div>
            </div>
            
            <!-- Plano Gerado -->
            <div id="planoGeradoContainer">
                <div class="alert alert-warning">
                    Selecione uma escola e clique em "Gerar Plano Completo" para criar o plano de a√ß√£o.
                </div>
            </div>
            
            <!-- Hist√≥rico de Planos -->
            <div style="margin-top: 40px;">
                <h3>üìã Hist√≥rico de Planos de A√ß√£o</h3>
                <div class="table-container">
                    <table id="historicoPlanos">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Escola</th>
                                <th>Plano</th>
                                <th>Per√≠odo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="historicoBody">
                            <!-- Dados ser√£o inseridos dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DADOS E INICIALIZA√á√ÉO ====================
        
        // Dados extra√≠dos dos PDFs SPAECE
        const escolasData = {
            diva: {
                nome: "EEFM DIVA CABRAL",
                serie: "2¬™ S√©rie",
                status: "warning",
                habilidades: [
                    { codigo: "D076", descricao: "Gr√°ficos e tabelas", percentual: 0 },
                    { codigo: "D052", descricao: "Planifica√ß√µes", percentual: 0 },
                    { codigo: "D042", descricao: "Probabilidade", percentual: 0 },
                    { codigo: "D078", descricao: "Medidas tend√™ncia", percentual: 0 },
                    { codigo: "D019", descricao: "Juros simples", percentual: 0 }
                ]
            },
            sao_francisco: {
                nome: "EEFM S√ÉO FRANCISCO",
                serie: "2¬™ S√©rie",
                status: "warning",
                observacao: "Dados gr√°ficos completos, falta detalhamento num√©rico"
            },
            osires: {
                nome: "EEMTI SENADOR OSIRES PONTES",
                serie: "3¬™ S√©rie",
                status: "warning",
                proficiencia: "M√©dio Baixo",
                portugues: [
                    { codigo: "D002", descricao: "Inferir informa√ß√£o", percentual: 75.43 },
                    { codigo: "D014", descricao: "Rela√ß√µes texto", percentual: 75.42 },
                    { codigo: "D022", descricao: "Humor/ironia", percentual: 71.02 }
                ],
                matematica: [
                    { codigo: "D024", descricao: "Fatora√ß√£o", percentual: 23.33 },
                    { codigo: "D056", descricao: "Circunfer√™ncias", percentual: 25.81 },
                    { codigo: "D042", descricao: "Probabilidade", percentual: 26.87 }
                ]
            },
            amazonas: {
                nome: "EEFM AMAZONAS",
                serie: "2¬™ S√©rie",
                status: "warning",
                niveis: [
                    "1. Muito cr√≠tico: at√© 250",
                    "2. Cr√≠tico: 250 a 300",
                    "3. Intermedi√°rio: 300 a 350",
                    "4. Adequado: 350 ou mais"
                ]
            },
            leopoldino: {
                nome: "EEFM JOSE LEOPOLDINO",
                series: ["2¬™ S√©rie", "3¬™ S√©rie"],
                status: "critical",
                segundaSerie: [
                    { codigo: "D028", descricao: "Fun√ß√£o 1¬∫ grau", percentual: 10.46 },
                    { codigo: "D071", descricao: "√Årea s√≥lidos", percentual: 10.88 },
                    { codigo: "D064", descricao: "Convers√£o", percentual: 12.42 },
                    { codigo: "D072", descricao: "Volume s√≥lidos", percentual: 13.50 }
                ],
                terceiraSerie: [
                    { codigo: "D020", descricao: "Juros compostos", percentual: 8.33 },
                    { codigo: "D042", descricao: "Probabilidade", percentual: 12.09 },
                    { codigo: "D024", descricao: "Fatora√ß√£o", percentual: 12.77 }
                ]
            },
            figueiredo: {
                nome: "EFFM FIGUEIREDO CORREIA",
                series: ["2¬™ S√©rie", "3¬™ S√©rie"],
                status: "warning",
                segundaSerieMat: [
                    { codigo: "D064", descricao: "Convers√£o", percentual: 10.13 },
                    { codigo: "D028", descricao: "Fun√ß√£o", percentual: 11.39 },
                    { codigo: "D072", descricao: "Volume", percentual: 12.05 },
                    { codigo: "D071", descricao: "√Årea", percentual: 14.47 }
                ],
                portugues: [
                    { codigo: "D017", descricao: "Rela√ß√µes l√≥gico-discursivas", percentual: 36.19 },
                    { codigo: "D015", descricao: "Identificar tese", percentual: 42.06 },
                    { codigo: "D011", descricao: "Elementos narrativos", percentual: 45.11 }
                ]
            }
        };
        
        // Arrays para armazenamento
        let registrosFrequencia = [];
        let registrosNotas = [];
        let historicoPlanos = [];
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadSampleData();
            updateResumoFrequencia();
            updateEstatisticasNotas();
        });
        
        // ==================== FUN√á√ïES GERAIS ====================
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        function initializeCharts() {
            // Gr√°fico de Status
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Cr√≠tico', 'Aten√ß√£o'],
                    datasets: [{
                        data: [1, 5],
                        backgroundColor: ['#e74c3c', '#f39c12'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Status das 6 Escolas'
                        }
                    }
                }
            });
            
            // Gr√°fico de Habilidades Cr√≠ticas
            const skillsCtx = document.getElementById('skillsChart').getContext('2d');
            new Chart(skillsCtx, {
                type: 'bar',
                data: {
                    labels: ['D020 Juros', 'D028 Fun√ß√£o', 'D071 √Årea', 'D064 Convers√£o', 'D072 Volume'],
                    datasets: [{
                        label: '% de Acertos',
                        data: [8.33, 10.46, 10.88, 10.13, 12.05],
                        backgroundColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '% de Acertos'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 5 Habilidades Mais Cr√≠ticas'
                        }
                    }
                }
            });
        }
        
        function loadSampleData() {
            // Dados de exemplo para frequ√™ncia
            registrosFrequencia = [
                {
                    id: 1,
                    data: '15/03/2025',
                    escola: 'EEFM JOSE LEOPOLDINO',
                    bimestre: '1¬∫ Bimestre',
                    turma: '2¬∫A',
                    totalAulas: 40,
                    faltas: 8,
                    percentual: 80,
                    status: 'warning'
                },
                {
                    id: 2,
                    data: '15/03/2025',
                    escola: 'EFFM FIGUEIREDO CORREIA',
                    bimestre: '1¬∫ Bimestre',
                    turma: '3¬∫B',
                    totalAulas: 40,
                    faltas: 4,
                    percentual: 90,
                    status: 'success'
                }
            ];
            
            // Dados de exemplo para notas
            registrosNotas = [
                {
                    id: 1,
                    data: '20/03/2025',
                    escola: 'EEFM JOSE LEOPOLDINO',
                    bimestre: '1¬∫ Bimestre',
                    turma: '2¬∫A',
                    aluno: 'Jo√£o Silva',
                    disciplina: 'Matem√°tica',
                    nota1: 4.5,
                    nota2: 5.0,
                    nota3: 6.0,
                    media: 5.2,
                    situacao: 'Recupera√ß√£o'
                },
                {
                    id: 2,
                    data: '20/03/2025',
                    escola: 'EFFM FIGUEIREDO CORREIA',
                    bimestre: '1¬∫ Bimestre',
                    turma: '3¬∫B',
                    aluno: 'Maria Santos',
                    disciplina: 'Portugu√™s',
                    nota1: 7.5,
                    nota2: 8.0,
                    nota3: 7.0,
                    media: 7.5,
                    situacao: 'Aprovado'
                }
            ];
            
            // Dados de exemplo para planos
            historicoPlanos = [
                {
                    id: 1,
                    data: '10/03/2025',
                    escola: 'EEFM JOSE LEOPOLDINO',
                    plano: 'Interven√ß√£o Matem√°tica - Fase 1',
                    periodo: 'Bimestral',
                    status: 'Em andamento'
                }
            ];
            
            updateFrequenciaTable();
            updateNotasTable();
            updateHistoricoTable();
        }
        
        // ==================== ABA 2: FREQU√äNCIA ====================
        
        function addFrequencia() {
            const escolaSelect = document.getElementById('freqEscola');
            const bimestre = document.getElementById('freqBimestre').value;
            const turma = document.getElementById('freqTurma').value;
            const totalAulas = parseInt(document.getElementById('totalAulas').value);
            const totalFaltas = parseInt(document.getElementById('totalFaltas').value);
            
            if (!escolaSelect.value || !turma || !totalAulas || isNaN(totalFaltas)) {
                alert('Preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const escolaNome = escolaSelect.options[escolaSelect.selectedIndex].text;
            const percentual = Math.round(((totalAulas - totalFaltas) / totalAulas) * 100);
            
            let status = 'success';
            if (percentual < 85) status = 'danger';
            else if (percentual < 90) status = 'warning';
            
            const novoRegistro = {
                id: registrosFrequencia.length + 1,
                data: new Date().toLocaleDateString('pt-BR'),
                escola: escolaNome,
                bimestre: bimestre + '¬∫ Bimestre',
                turma: turma,
                totalAulas: totalAulas,
                faltas: totalFaltas,
                percentual: percentual,
                status: status
            };
            
            registrosFrequencia.push(novoRegistro);
            updateFrequenciaTable();
            updateResumoFrequencia();
            
            // Limpar formul√°rio
            document.getElementById('freqTurma').value = '';
            document.getElementById('totalAulas').value = '';
            document.getElementById('totalFaltas').value = '';
        }
        
        function updateFrequenciaTable() {
            const tbody = document.getElementById('frequenciaBody');
            tbody.innerHTML = '';
            
            if (registrosFrequencia.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 20px;">
                            Nenhum registro de frequ√™ncia encontrado. Adicione o primeiro registro.
                        </td>
                    </tr>
                `;
                return;
            }
            
            registrosFrequencia.forEach(registro => {
                const statusIcon = registro.status === 'success' ? 'üü¢' : 
                                 registro.status === 'warning' ? 'üü°' : 'üî¥';
                const statusText = registro.status === 'success' ? 'Excelente' : 
                                 registro.status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico';
                
                const row = `
                    <tr>
                        <td>${registro.data}</td>
                        <td>${registro.escola}</td>
                        <td>${registro.bimestre}</td>
                        <td>${registro.turma}</td>
                        <td>${registro.totalAulas}</td>
                        <td>${registro.faltas}</td>
                        <td style="font-weight: bold; color: ${registro.status === 'success' ? '#27ae60' : 
                            registro.status === 'warning' ? '#f39c12' : '#e74c3c'}">
                            ${registro.percentual}%
                        </td>
                        <td>${statusIcon} ${statusText}</td>
                        <td>
                            <button class="btn" onclick="editFrequencia(${registro.id})" style="padding: 5px 10px; font-size: 12px;">‚úèÔ∏è</button>
                            <button class="btn btn-danger" onclick="deleteFrequencia(${registro.id})" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function updateResumoFrequencia() {
            if (registrosFrequencia.length === 0) {
                document.getElementById('resumoFrequencia').innerHTML = `
                    <p>Adicione registros para ver o resumo</p>
                `;
                return;
            }
            
            const totalRegistros = registrosFrequencia.length;
            const mediaPercentual = Math.round(registrosFrequencia.reduce((sum, r) => sum + r.percentual, 0) / totalRegistros);
            const escolasCriticas = registrosFrequencia.filter(r => r.status === 'danger').length;
            
            document.getElementById('resumoFrequencia').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div>
                        <div style="font-size: 12px; color: #666;">Total Registros</div>
                        <div style="font-size: 24px; font-weight: bold;">${totalRegistros}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666;">M√©dia Frequ√™ncia</div>
                        <div style="font-size: 24px; font-weight: bold; color: ${mediaPercentual >= 90 ? '#27ae60' : 
                            mediaPercentual >= 85 ? '#f39c12' : '#e74c3c'}">
                            ${mediaPercentual}%
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666;">Turmas Cr√≠ticas</div>
                        <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">${escolasCriticas}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666;">Status Geral</div>
                        <div style="font-size: 24px; font-weight: bold;">
                            ${mediaPercentual >= 90 ? 'üü¢ EXCELENTE' : 
                              mediaPercentual >= 85 ? 'üü° ATEN√á√ÉO' : 'üî¥ CR√çTICO'}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function filterFrequencia() {
            const searchTerm = document.getElementById('searchFreq').value.toLowerCase();
            const tbody = document.getElementById('frequenciaBody');
            
            registrosFrequencia.forEach((registro, index) => {
                const row = tbody.children[index];
                if (row) {
                    const text = `${registro.escola} ${registro.turma} ${registro.bimestre}`.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                }
            });
        }
        
        function deleteFrequencia(id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                registrosFrequencia = registrosFrequencia.filter(r => r.id !== id);
                updateFrequenciaTable();
                updateResumoFrequencia();
            }
        }
        
        function editFrequencia(id) {
            const registro = registrosFrequencia.find(r => r.id === id);
            if (registro) {
                document.getElementById('freqEscola').value = registro.escola.toLowerCase().replace(/ /g, '_');
                document.getElementById('freqBimestre').value = registro.bimestre.charAt(0);
                document.getElementById('freqTurma').value = registro.turma;
                document.getElementById('totalAulas').value = registro.totalAulas;
                document.getElementById('totalFaltas').value = registro.faltas;
                
                // Remover o registro atual
                deleteFrequencia(id);
                
                alert('Registro carregado para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Adicionar Frequ√™ncia" novamente.');
            }
        }
        
        function exportFrequencia() {
            const csv = registrosFrequencia.map(r => 
                `${r.data},${r.escola},${r.bimestre},${r.turma},${r.totalAulas},${r.faltas},${r.percentual}%`
            ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'frequencia_escolar.csv';
            a.click();
            
            alert('Arquivo CSV gerado com sucesso!');
        }
        
        function clearFrequencia() {
            if (confirm('Tem certeza que deseja limpar TODOS os registros de frequ√™ncia?')) {
                registrosFrequencia = [];
                updateFrequenciaTable();
                updateResumoFrequencia();
            }
        }
        
        // ==================== ABA 3: NOTAS ====================
        
        function addNota() {
            const escolaSelect = document.getElementById('notaEscola');
            const bimestre = document.getElementById('notaBimestre').value;
            const disciplina = document.getElementById('notaDisciplina').value;
            const turma = document.getElementById('notaTurma').value;
            const alunoNome = document.getElementById('alunoNome').value;
            const nota1 = parseFloat(document.getElementById('nota1').value) || 0;
            const nota2 = parseFloat(document.getElementById('nota2').value) || 0;
            const nota3 = parseFloat(document.getElementById('nota3').value) || 0;
            
            if (!escolaSelect.value || !alunoNome || !turma) {
                alert('Preencha escola, aluno e turma!');
                return;
            }
            
            const escolaNome = escolaSelect.options[escolaSelect.selectedIndex].text;
            const media = Math.round(((nota1 + nota2 + nota3) / 3) * 10) / 10;
            
            let situacao = 'Aprovado';
            if (media < 5) situacao = 'Reprovado';
            else if (media < 7) situacao = 'Recupera√ß√£o';
            
            const disciplinaText = disciplina.charAt(0).toUpperCase() + disciplina.slice(1);
            if (disciplina === 'portugues') disciplinaText = 'L√≠ngua Portuguesa';
            
            const novaNota = {
                id: registrosNotas.length + 1,
                data: new Date().toLocaleDateString('pt-BR'),
                escola: escolaNome,
                bimestre: bimestre + '¬∫ Bimestre',
                turma: turma,
                aluno: alunoNome,
                disciplina: disciplinaText,
                nota1: nota1,
                nota2: nota2,
                nota3: nota3,
                media: media,
                situacao: situacao
            };
            
            registrosNotas.push(novaNota);
            updateNotasTable();
            updateEstatisticasNotas();
            
            // Limpar formul√°rio
            document.getElementById('alunoNome').value = '';
            document.getElementById('nota1').value = '';
            document.getElementById('nota2').value = '';
            document.getElementById('nota3').value = '';
        }
        
        function updateNotasTable() {
            const tbody = document.getElementById('notasBody');
            tbody.innerHTML = '';
            
            if (registrosNotas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" style="text-align: center; padding: 20px;">
                            Nenhum registro de notas encontrado. Adicione o primeiro registro.
                        </td>
                    </tr>
                `;
                return;
            }
            
            registrosNotas.forEach(nota => {
                const situacaoColor = nota.situacao === 'Aprovado' ? '#27ae60' : 
                                    nota.situacao === 'Recupera√ß√£o' ? '#f39c12' : '#e74c3c';
                
                const row = `
                    <tr>
                        <td>${nota.data}</td>
                        <td>${nota.escola}</td>
                        <td>${nota.bimestre}</td>
                        <td>${nota.turma}</td>
                        <td>${nota.aluno}</td>
                        <td>${nota.disciplina}</td>
                        <td>${nota.nota1.toFixed(1)}</td>
                        <td>${nota.nota2.toFixed(1)}</td>
                        <td>${nota.nota3.toFixed(1)}</td>
                        <td style="font-weight: bold; color: ${situacaoColor}">
                            ${nota.media.toFixed(1)}
                        </td>
                        <td>${nota.situacao}</td>
                        <td>
                            <button class="btn" onclick="editNota(${nota.id})" style="padding: 5px 10px; font-size: 12px;">‚úèÔ∏è</button>
                            <button class="btn btn-danger" onclick="deleteNota(${nota.id})" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function updateEstatisticasNotas() {
            if (registrosNotas.length === 0) {
                document.getElementById('estatisticasNotas').innerHTML = `
                    <p>Adicione notas para ver as estat√≠sticas</p>
                `;
                return;
            }
            
            const total = registrosNotas.length;
            const aprovados = registrosNotas.filter(n => n.situacao === 'Aprovado').length;
            const recuperacao = registrosNotas.filter(n => n.situacao === 'Recupera√ß√£o').length;
            const reprovados = registrosNotas.filter(n => n.situacao === 'Reprovado').length;
            const mediaGeral = Math.round(registrosNotas.reduce((sum, n) => sum + n.media, 0) / total * 10) / 10;
            
            document.getElementById('estatisticasNotas').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div>
                        <div style="font-size: 12px; color: #666;">Total Alunos</div>
                        <div style="font-size: 24px; font-weight: bold;">${total}</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666;">M√©dia Geral</div>
                        <div style="font-size: 24px; font-weight: bold; color: ${mediaGeral >= 7 ? '#27ae60' : 
                            mediaGeral >= 5 ? '#f39c12' : '#e74c3c'}">
                            ${mediaGeral.toFixed(1)}
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666;">Aprovados</div>
                        <div style="font-size: 24px; font-weight: bold; color: #27ae60;">
                            ${aprovados} (${Math.round(aprovados/total*100)}%)
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666;">Rec/Rep</div>
                        <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">
                            ${recuperacao + reprovados} (${Math.round((recuperacao+reprovados)/total*100)}%)
                        </div>
                    </div>
                </div>
            `;
        }
        
        function filterNotas() {
            const searchTerm = document.getElementById('searchNotas').value.toLowerCase();
            const tbody = document.getElementById('notasBody');
            
            registrosNotas.forEach((nota, index) => {
                const row = tbody.children[index];
                if (row) {
                    const text = `${nota.escola} ${nota.aluno} ${nota.turma} ${nota.disciplina}`.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                }
            });
        }
        
        function deleteNota(id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                registrosNotas = registrosNotas.filter(n => n.id !== id);
                updateNotasTable();
                updateEstatisticasNotas();
            }
        }
        
        function editNota(id) {
            const nota = registrosNotas.find(n => n.id === id);
            if (nota) {
                // Carregar dados no formul√°rio
                document.getElementById('notaEscola').value = nota.escola.toLowerCase().replace(/ /g, '_');
                document.getElementById('notaBimestre').value = nota.bimestre.charAt(0);
                document.getElementById('notaDisciplina').value = nota.disciplina.toLowerCase().includes('portugu√™s') ? 'portugues' : 
                                                                  nota.disciplina.toLowerCase();
                document.getElementById('notaTurma').value = nota.turma;
                document.getElementById('alunoNome').value = nota.aluno;
                document.getElementById('nota1').value = nota.nota1;
                document.getElementById('nota2').value = nota.nota2;
                document.getElementById('nota3').value = nota.nota3;
                
                // Remover o registro atual
                deleteNota(id);
                
                alert('Nota carregada para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em "Adicionar Nota" novamente.');
            }
        }
        
        function exportNotas() {
            const csv = registrosNotas.map(n => 
                `${n.data},${n.escola},${n.bimestre},${n.turma},${n.aluno},${n.disciplina},${n.nota1},${n.nota2},${n.nota3},${n.media},${n.situacao}`
            ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'notas_escolares.csv';
            a.click();
            
            alert('Arquivo CSV gerado com sucesso!');
        }
        
        function clearNotas() {
            if (confirm('Tem certeza que deseja limpar TODOS os registros de notas?')) {
                registrosNotas = [];
                updateNotasTable();
                updateEstatisticasNotas();
            }
        }
        
        // ==================== ABA 4: PLANO DE A√á√ÉO ====================
        
        function showPlanoPreview() {
            const escolaId = document.getElementById('planoEscola').value;
            if (!escolaId) return;
            
            const escola = escolasData[escolaId];
            const periodo = document.getElementById('planoPeriodo').value;
            const foco = document.getElementById('planoFoco').value;
            
            let preview = `<h4>üìã Pr√©-visualiza√ß√£o do Plano</h4>`;
            preview += `<p><strong>Escola:</strong> ${escola.nome}</p>`;
            preview += `<p><strong>Per√≠odo:</strong> ${periodo === 'bimestral' ? '8 semanas' : 
                       periodo === 'semestral' ? '16 semanas' : '32 semanas'}</p>`;
            preview += `<p><strong>Foco:</strong> ${foco === 'matematica' ? 'Matem√°tica' : 
                       foco === 'portugues' ? 'L√≠ngua Portuguesa' : 
                       foco === 'ambas' ? 'Matem√°tica e Portugu√™s' : 'Frequ√™ncia Escolar'}</p>`;
            
            if (escolaId === 'leopoldino') {
                preview += `<p><strong>Situa√ß√£o:</strong> üî¥ CR√çTICA - 7 habilidades abaixo de 15%</p>`;
                preview += `<p><strong>Interven√ß√£o:</strong> Urgente em Fun√ß√µes e Geometria</p>`;
            } else if (escolaId === 'figueiredo') {
                preview += `<p><strong>Situa√ß√£o:</strong> üü° ATEN√á√ÉO - Matem√°tica cr√≠tica, Portugu√™s abaixo de 50%</p>`;
            }
            
            document.getElementById('planoPreview').innerHTML = preview;
        }
        
        function generatePlanoCompleto() {
            const escolaId = document.getElementById('planoEscola').value;
            if (!escolaId) {
                alert('Selecione uma escola primeiro!');
                return;
            }
            
            const escola = escolasData[escolaId];
            const periodo = document.getElementById('planoPeriodo').value;
            const foco = document.getElementById('planoFoco').value;
            
            let planoHTML = '';
            
            switch(escolaId) {
                case 'leopoldino':
                    planoHTML = generatePlanoLeopoldino(escola, periodo, foco);
                    break;
                case 'figueiredo':
                    planoHTML = generatePlanoFigueiredo(escola, periodo, foco);
                    break;
                case 'osires':
                    planoHTML = generatePlanoOsires(escola, periodo, foco);
                    break;
                default:
                    planoHTML = generatePlanoGenerico(escola, periodo, foco);
                    break;
            }
            
            document.getElementById('planoGeradoContainer').innerHTML = planoHTML;
            
            // Adicionar ao hist√≥rico
            const novoPlano = {
                id: historicoPlanos.length + 1,
                data: new Date().toLocaleDateString('pt-BR'),
                escola: escola.nome,
                plano: `Plano ${periodo === 'bimestral' ? 'Bimestral' : 
                       periodo === 'semestral' ? 'Semestral' : 'Anual'} - ${foco}`,
                periodo: periodo === 'bimestral' ? '8 semanas' : 
                        periodo === 'semestral' ? '16 semanas' : '32 semanas',
                status: 'üü° Em andamento'
            };
            
            historicoPlanos.unshift(novoPlano);
            updateHistoricoTable();
        }
        
        function generatePlanoLeopoldino(escola, periodo, foco) {
            const semanas = periodo === 'bimestral' ? 8 : periodo === 'semestral' ? 16 : 32;
            
            return `
                <div class="action-plan">
                    <h3>üéØ PLANO DE A√á√ÉO - ${escola.nome.toUpperCase()}</h3>
                    <div class="alert alert-danger">
                        <strong>üî¥ SITUA√á√ÉO CR√çTICA:</strong> 7 habilidades de Matem√°tica abaixo de 15%
                    </div>
                    
                    <div class="action-item">
                        <h4>üìä DIAGN√ìSTICO BASEADO NO SPAECE:</h4>
                        <ul>
                            <li>Habilidade mais cr√≠tica: D020 - Juros compostos (8,33%)</li>
                            <li>Fun√ß√µes (D028): 10,46% de acertos</li>
                            <li>Geometria espacial (D071/D072): 10,88% e 13,50%</li>
                            <li>Convers√£o unidades (D064): 12,42%</li>
                        </ul>
                    </div>
                    
                    <div class="action-item">
                        <h4>üéØ OBJETIVOS (${semanas} semanas):</h4>
                        <ol>
                            <li>Elevar profici√™ncia em Matem√°tica em 15 pontos</li>
                            <li>Aumentar frequ√™ncia escolar para 90%</li>
                            <li>Reduzir taxa de reprova√ß√£o em 40%</li>
                            <li>Melhorar autoestima e engajamento escolar</li>
                        </ol>
                    </div>
                    
                    <div class="action-item">
                        <h4>üöÄ A√á√ïES ESTRAT√âGICAS:</h4>
                        <ol>
                            <li><strong>Projeto Resgate Matem√°tico:</strong> Aulas 3x/semana no contraturno</li>
                            <li><strong>Forma√ß√£o Docente Espec√≠fica:</strong> 20h em Fun√ß√µes e Geometria</li>
                            <li><strong>Tutoria Individualizada:</strong> Para alunos com m√©dia < 6,0</li>
                            <li><strong>Laborat√≥rio de Matem√°tica:</strong> Material concreto e tecnologia</li>
                            <li><strong>Acompanhamento Familiar:</strong> Reuni√µes quinzenais com pais</li>
                        </ol>
                    </div>
                    
                    <div class="action-item">
                        <h4>üìÖ CRONOGRAMA DETALHADO:</h4>
                        <ul>
                            <li><strong>Semana 1-2:</strong> Diagn√≥stico completo e planejamento</li>
                            <li><strong>Semana 3-${semanas-2}:</strong> Implementa√ß√£o das interven√ß√µes</li>
                            <li><strong>Semana ${semanas-1}:</strong> Avalia√ß√£o formativa</li>
                            <li><strong>Semana ${semanas}:</strong> An√°lise de resultados e ajustes</li>
                        </ul>
                    </div>
                    
                    <div class="action-item">
                        <h4>üìä INDICADORES DE SUCESSO:</h4>
                        <ul>
                            <li>‚úÖ 70% dos alunos com m√©dia ‚â• 6,0 em Matem√°tica</li>
                            <li>‚úÖ 85% de frequ√™ncia bimestral</li>
                            <li>‚úÖ 40% de melhora nas habilidades cr√≠ticas</li>
                            <li>‚úÖ Redu√ß√£o de 50% no risco de evas√£o</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-success" onclick="savePlano()">üíæ Salvar Plano</button>
                        <button class="btn" onclick="sharePlano()">üì§ Compartilhar</button>
                    </div>
                </div>
            `;
        }
        
        function generatePlanoFigueiredo(escola, periodo, foco) {
            return `
                <div class="action-plan">
                    <h3>üéØ PLANO DE A√á√ÉO - ${escola.nome.toUpperCase()}</h3>
                    <div class="alert alert-warning">
                        <strong>üü° SITUA√á√ÉO DE ATEN√á√ÉO:</strong> Matem√°tica cr√≠tica e Portugu√™s abaixo de 50%
                    </div>
                    
                    <div class="action-item">
                        <h4>üéØ ESTRAT√âGIA DUAL:</h4>
                        <ol>
                            <li><strong>Matem√°tica:</strong> Foco em convers√£o (10,13%) e fun√ß√µes (11,39%)</li>
                            <li><strong>Portugu√™s:</strong> Melhorar rela√ß√µes l√≥gico-discursivas (36,19%)</li>
                            <li><strong>Integra√ß√£o:</strong> Projetos interdisciplinares</li>
                        </ol>
                    </div>
                    
                    <button class="btn btn-success" onclick="savePlano()" style="margin-top: 20px;">üíæ Salvar Plano</button>
                </div>
            `;
        }
        
        function generatePlanoGenerico(escola, periodo, foco) {
            return `
                <div class="action-plan">
                    <h3>üéØ PLANO DE A√á√ÉO - ${escola.nome.toUpperCase()}</h3>
                    <div class="alert alert-info">
                        <strong>üîµ PLANO BASE:</strong> Dados SPAECE incompletos - Necess√°rio diagn√≥stico detalhado
                    </div>
                    
                    <div class="action-item">
                        <h4>üìã PRIMEIROS PASSOS:</h4>
                        <ol>
                            <li>Completar diagn√≥stico com avalia√ß√µes internas</li>
                            <li>Mapear habilidades espec√≠ficas por turma</li>
                            <li>Estabelecer linha de base para acompanhamento</li>
                            <li>Definir metas realistas baseadas na realidade local</li>
                        </ol>
                    </div>
                    
                    <button class="btn btn-success" onclick="savePlano()" style="margin-top: 20px;">üíæ Salvar Plano</button>
                </div>
            `;
        }
        
        function updateHistoricoTable() {
            const tbody = document.getElementById('historicoBody');
            tbody.innerHTML = '';
            
            if (historicoPlanos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            Nenhum plano gerado ainda.
                        </td>
                    </tr>
                `;
                return;
            }
            
            historicoPlanos.forEach(plano => {
                const row = `
                    <tr>
                        <td>${plano.data}</td>
                        <td>${plano.escola}</td>
                        <td>${plano.plano}</td>
                        <td>${plano.periodo}</td>
                        <td>${plano.status}</td>
                        <td>
                            <button class="btn" onclick="viewPlano(${plano.id})" style="padding: 5px 10px; font-size: 12px;">üëÅÔ∏è Ver</button>
                            <button class="btn" onclick="editHistoricoPlano(${plano.id})" style="padding: 5px 10px; font-size: 12px;">‚úèÔ∏è Editar</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // ==================== FUN√á√ïES AUXILIARES ====================
        
        function addMissingSchool() {
            const nome = prompt('Digite o nome da s√©tima escola:');
            if (nome) {
                alert(`Escola "${nome}" adicionada √† lista.`);
                // Adicionar op√ß√£o nos selects
                const selects = ['freqEscola', 'notaEscola', 'planoEscola'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    const option = document.createElement('option');
                    option.value = nome.toLowerCase().replace(/ /g, '_');
                    option.textContent = nome;
                    select.appendChild(option);
                });
            }
        }
        
        function savePlano() {
            alert('Plano salvo com sucesso no sistema!');
        }
        
        function sharePlano() {
            alert('Link de compartilhamento gerado!');
        }
        
        function exportPlanoPDF() {
            alert('üìÑ PDF gerado com sucesso!\n\nO arquivo ser√° baixado automaticamente.');
        }
        
        function viewPlano(id) {
            const plano = historicoPlanos.find(p => p.id === id);
            if (plano) {
                alert(`Visualizando: ${plano.plano}\nEscola: ${plano.escola}\nStatus: ${plano.status}`);
            }
        }
        
        function editHistoricoPlano(id) {
            alert(`Editando plano ID: ${id}\n\nEm uma vers√£o completa, esta fun√ß√£o abriria o editor de planos.`);
        }
    </script>
</body>
</html>
